"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const mpserverless_core_1 = require("@alicloud/mpserverless-core");
const mongo_1 = require("./mongo");
class QueryService extends mongo_1.Query {
    execute() {
        const _super = Object.create(null, {
            execute: { get: () => super.execute }
        });
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const params = yield _super.execute.call(this);
            const request = this.getEncoder()
                .setBodyField({
                method: 'serverless.db.default.execute',
                params,
            });
            const response = yield this.getTransport().request(request);
            return (new mongo_1.Result(response.body)).inspect();
        });
    }
}
exports.QueryService = QueryService;
class DbService extends mpserverless_core_1.BaseService {
    collection(name) {
        const q = (new QueryService()).collection(name);
        q.getEncoder = () => this.getEncoder();
        q.getTransport = () => this.transport;
        return q;
    }
}
exports.DbService = DbService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbUVBSXFDO0FBQ3JDLG1DQUlpQjtBQUVqQixNQUFhLFlBQWEsU0FBUSxhQUFLO0lBUXhCLE9BQU87Ozs7O1lBQ2xCLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTSxPQUFPLFdBQUUsQ0FBQztZQUVyQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFO2lCQUM5QixZQUFZLENBQUM7Z0JBQ1osTUFBTSxFQUFFLCtCQUErQjtnQkFDdkMsTUFBTTthQUNQLENBQUMsQ0FBQztZQUVMLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM1RCxPQUFPLENBQUMsSUFBSSxjQUFNLENBQUMsUUFBUSxDQUFDLElBQStCLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzFFLENBQUM7S0FBQTtDQUNGO0FBcEJELG9DQW9CQztBQUVELE1BQWEsU0FBVSxTQUFRLCtCQUFXO0lBTWpDLFVBQVUsQ0FBQyxJQUFZO1FBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxZQUFZLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsVUFBVSxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN2QyxDQUFDLENBQUMsWUFBWSxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDdEMsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0NBQ0Y7QUFaRCw4QkFZQyJ9